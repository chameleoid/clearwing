/*! clearwing 2013-03-19 */
function Channel(t,e){this.client=t.client,this.network=t,this.users=[],e=Channel.sanitize(e),this._name=e.toLowerCase(),this.set("name",e).set("topic","").set("mode","").set("joined",!1)}function Clearwing(){this.networks=[],this._data={},this._events={},this.set("nick","Fish"+Math.floor(1e3*Math.random()))}function Network(t,e){this.client=t,this.channels=[],this.users=[],this._name=e.toLowerCase(),this.set("name",e).set("connected",!1).set("status","disconnected").set("nick",t.get("nick")).set("server","").set("port",6667)}function User(t,e){this.client=t.client,this.network=t,this.channels=[],e=User.sanitize(e),this._name=e.toLowerCase(),this.set("name",e)}var _=require("underscore");Channel.sanitize=function(t){return t.replace(/^([^#+!&])/,"#$1")},Channel.prototype.user=function(t){return this.users.filter(function(e){return e._name==t.toLowerCase()}).pop()||this.users[this.users.push(this.network.user(t))-1]},Channel.prototype.hasUser=function(t){return!!this.users.filter(function(e){return e._name==t.toLowerCase()}).length},Channel.prototype.get=function(){return this.network.get.apply(this.network,[{channel:this._name}].concat(_.toArray(arguments)))},Channel.prototype.set=function(){return this.network.set.apply(this.network,[{channel:this._name}].concat(_.toArray(arguments)))},module.exports=Channel;var _=require("underscore"),Network=require("./network");Clearwing.prototype.get=function(){return this._data[Clearwing.stringifyPropName(arguments)]},Clearwing.prototype.set=function(){return this._data[Clearwing.stringifyPropName(_.toArray(arguments).slice(0,-1))]=arguments[arguments.length-1],this},Clearwing.prototype.on=function(){var t=_.toArray(arguments),e=t.splice(-1).pop(),n=e,r=t.splice(-1).pop(),s=r,i="",o=this;return t.push(_.isRegExp(s)?"msg":r),i=Clearwing.stringifyPropName(t),_.isFunction(e)?(_.isRegExp(s)&&(e=function(t){s.test(t.text)&&t.text.match(s,n.bind(o,t))}),(this._events[i]=this._events[i]||[]).push(e),this):this},Clearwing.prototype.emit=function(){var t=_.toArray(arguments),e=(t.splice(-1).pop(),""),n=[],r=[[/(user).[^ ]+/,"$1"],[/(user).[^ ]+ /,""],[/(channel).[^ ]+/,"$1"],[/(channel).[^ ]+ /,""],[/(network).[^ ]+/,"$1"],[/(network).[^ ]+ /,""]];return e=Clearwing.stringifyPropName(t),n.push(e),r.forEach(function(t){n.forEach(function(e){n.push(e.replace.apply(e,t))})}),n=_.chain(n).uniq().sortBy(function(t){return(/network([. ]|$)/.test(t)||-800)+(/channel([. ]|$)/.test(t)||-400)+(/user([. ]|$)/.test(t)||-200)+t.length}).value(),this},Clearwing.stringifyPropName=function(t){return _.map(t,function(t){return _.isObject(t)&&!_.isArray(t)?_.chain(t).pairs().flatten().join(".").value():t}).join(" ").toLowerCase()},Clearwing.parsePropName=function(t){return _.map(t.toLowerCase().split(" "),function(t){var e=t.split("."),n={};return 2>e.length?t:(n[e[0]]=e.slice(1).join("."),n)})},Clearwing.prototype.network=function(t){return this.networks.filter(function(e){return e._name==t.toLowerCase()}).pop()||this.networks[this.networks.push(new Network(this,t))-1]},Clearwing.prototype.hasNetwork=function(t){return!!this.networks.filter(function(e){return e._name==t.toLowerCase()}).length},Clearwing.prototype.use=function(t){return _.isFunction(t)&&t.call(this,this),this},module.exports=Clearwing;var _=require("underscore"),Clearwing=require("./clearwing"),Channel=require("./channel"),User=require("./user");Network.prototype.get=function(){return this.client.get.apply(this.client,[{network:this._name}].concat(_.toArray(arguments)))},Network.prototype.set=function(){return this.client.set.apply(this.client,[{network:this._name}].concat(_.toArray(arguments))),this},Network.prototype.channel=function(t){return this.channels.filter(function(e){return e._name==t.toLowerCase()}).pop()||this.channels[this.channels.push(new Channel(this,t))-1]},Network.prototype.hasChannel=function(t){return!!this.channels.filter(function(e){return e._name==t.toLowerCase()}).length},Network.prototype.user=function(t){return this.users.filter(function(e){return e._name==t.toLowerCase()}).pop()||this.users[this.users.push(new User(this,t))-1]},Network.prototype.hasUser=function(t){return!!this.users.filter(function(e){return e._name==t.toLowerCase()}).length},Network.prototype.parseMessage=function(t,e){return e=e||Date.now(),t.split(/\r\n/g).map(function(t){if(t.length){var n=t.match(/^((?::[^\0\r\n ]+ )?)([a-z]+|[0-9]{3})((?: [^\0\r\n :][^\0\r\n ]*){0,14})(( :?[^\0\r\n]*)?)/i),r=n[3].length?n[3].substr(1).split(" "):[],s={time:e,raw:t,prefix:n[1].substr(1,n[1].length-2),command:n[2],param:r.concat(n[4].substr(2))};return s}})},Network.prototype.emit=function(){return this.client.emit.apply(this.client,[{network:this._name}].concat(arguments))},Network.prototype.raw=function(t){return this._socket.write(t+"\r\n"),this},module.exports=Network;var _=require("underscore");User.sanitize=function(t){return t.replace(/^[^a-z\[\]\\`_\^{|}]/i,"").replace(/[^a-z0-9\[\]\\`_\^{|}-]/i,"")},User.prototype.channel=function(t){return this.channels.filter(function(e){return e._name==t.toLowerCase()}).pop()||this.channels[this.channels.push(this.network.channel(t))-1]},User.prototype.hasChannel=function(t){return!!this.channels.filter(function(e){return e._name==t.toLowerCase()}).length},User.prototype.get=function(){return this.network.get.apply(this.network,[{user:this._name}].concat(_.toArray(arguments)))},User.prototype.set=function(){return this.network.set.apply(this.network,[{user:this._name}].concat(_.toArray(arguments)))},module.exports=User;