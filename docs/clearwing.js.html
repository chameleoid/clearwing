<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: clearwing.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: clearwing.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var _       = require('underscore'),
    Network = require('./network');

/**
 * Clearwing object
 * @constructor
 */
function Clearwing(options) {
	/** {@link Network} list */
	this.networks = [];

	/** Stored data */
	this._data = {};

	/** Events */
	this._events = {};

	/* set up data */
	this
		.set('nick', 'Fish' + Math.floor(Math.random() * 1000));
}


/**
 * Lookup a property
 * @param {object...} [namespace] Namespace name
 * @param {string} property Property name
 * @return {mixed}
 */
Clearwing.prototype.get = function() {
	return this._data[Clearwing.stringifyPropName(arguments)];
};


/**
 * Set a property
 * @param {object...} [namespace] Namespace name
 * @param {string} property Property name
 * @param {mixed} value New property value
 * @return {Clearwing}
 */
Clearwing.prototype.set = function() {
	this._data[Clearwing.stringifyPropName(_.toArray(arguments).slice(0, -1))] = arguments[arguments.length - 1];
	return this;
};

/**
 * Bind an event
 * @param {object...} [namespace] Namespace name
 * @param {string|regexp} event Event name
 * @param {function} callback Callback function
 * @return {Clearwing}
 */
Clearwing.prototype.on = function() {
	var ns       = _.toArray(arguments),
	    callback = ns.splice(-1).pop(),
	    cb       = callback,
	    event    = ns.splice(-1).pop(),
	    regexp   = event,
	    prop     = '',
	    that     = this;

	ns.push(_.isRegExp(regexp) ? 'msg' : event);
	prop = Clearwing.stringifyPropName(ns);

	if (!_.isFunction(callback))
		return this;

	if (_.isRegExp(regexp)) {
		callback = function(event) {
			if (regexp.test(event.text))
				event.text.match(regexp, cb.bind(that, event));
		};
	}

	(this._events[prop] = this._events[prop] || []).push(callback);

	return this;
};


/**
 * Emit an event
 * @param {object...} [namespace] Namespace name
 * @param {string} event Event name
 * @param {object} data Event data
 * @return {Clearwing}
 */
Clearwing.prototype.emit = function() {
	var ns    = _.toArray(arguments),
	    data  = ns.splice(-1).pop(),
	    prop  = '',
	    props = [],
	    replace = [
		    [/(user).[^ ]+/, '$1'],
		    [/(user).[^ ]+ /, ''],
		    [/(channel).[^ ]+/, '$1'],
		    [/(channel).[^ ]+ /, ''],
		    [/(network).[^ ]+/, '$1'],
		    [/(network).[^ ]+ /, '']
	    ];

	prop = Clearwing.stringifyPropName(ns);

	props.push(prop);

	replace.forEach(function(re) {
		props.forEach(function(prop) {
			props.push(prop.replace.apply(prop, re));
		});
	});

	props = _.chain(props).uniq().sortBy(function(e) {
		return (/network([. ]|$)/.test(e) || -800) +
		       (/channel([. ]|$)/.test(e) || -400) +
		       (/user([. ]|$)/.test(e)    || -200) +
		       e.length;
	}).value();

	return this;
};


/**
 * Helper function for flattening lists into property-safe values
 * @param {array} prop Property name array
 * @return {string}
 */
Clearwing.stringifyPropName = function(prop) {
	// Convert [{ network: 'foobar' }, 'option']
	// to 'network.foobar option'
	return _.map(prop, function(a) {
		return _.isObject(a) && !_.isArray(a) ?
		       _.chain(a).pairs().flatten().join('.').value() :
		       a;
	}).join(' ').toLowerCase();
};


/**
 * Helper function to convert flat property names into array form
 * @param {string} prop Property string
 * @return {array}
 */
Clearwing.parsePropName = function(prop) {
	return _.map(prop.toLowerCase().split(' '), function(s) {
		// Yes, a.split('.', 2) would give us two elements, but
		// they would be equivalent to a.split('.').slice(0, 2)
		var a = s.split('.'),
		    o = {};

		if (a.length &lt; 2)
			return s;

		o[a[0]] = a.slice(1).join('.');
		return o;
	});
};


/**
 * Lookup a network by name
 *
 * Note: This function will also create a new {@link Network} if one is not found
 *
 * See {@link Clearwing#hasNetwork} if you want to know if a network exists
 * @param {string} network Network name
 * @return {Network}
 */
Clearwing.prototype.network = function(network) {
	return this.networks.filter(function(n) { return n._name == network.toLowerCase(); }).pop() ||
	       this.networks[this.networks.push(new Network(this, network)) - 1];
};


/**
 * See if a network exists
 * @param {string} network Network name
 * @return {bool} True if network exists, false if it does not
 */
Clearwing.prototype.hasNetwork = function(network) {
	return !!this.networks.filter(function(n) { return n._name == network.toLowerCase(); }).length;
};


/**
 * Use a plugin
 * @param {function} plugin
 * @return {Clearwing}
 */
Clearwing.prototype.use = function(plugin) {
	if (_.isFunction(plugin))
		plugin.call(this, this);

	return this;
};

module.exports = Clearwing;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Channel.html">Channel</a></li><li><a href="Clearwing.html">Clearwing</a></li><li><a href="Network.html">Network</a></li><li><a href="User.html">User</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Tue Mar 19 2013 16:33:01 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
